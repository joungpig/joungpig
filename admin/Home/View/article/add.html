<!DOCTYPE html>
<html lang="en">
<style>
    a{text-decoration: none!important;color:#f0c040!important;cursor:default;!important;}
    input{
        border-radius: 3px;height: 28px!important;
    }
</style>
<!--引入 head-->
<head>
    <meta charset="utf-8" />
    <title>joungpig后台</title>
    <meta name="description" content="Dashboard" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" href="__ADMIN__/add/img/icon9.png" type="image/x-icon">
    <link href="__ADMIN__/add/css/bootstrap.min.css" rel="stylesheet" />
    <link href="__ADMIN__/style/bootstrap-multiselect.css" rel="stylesheet">
    <link id="bootstrap-rtl-link" href="" rel="stylesheet" />
    <!--<link id="beyond-link" href="__PUBLIC__/add/css/beyond.min.css" rel="stylesheet" type="text/css" />-->
    <link href="__ADMIN__/add/css/font-awesome.min.css" rel="stylesheet" />
    <link href="__ADMIN__/add/css/weather-icons.min.css" rel="stylesheet" />
    <!--引入 Js-->
    <script src="__ADMIN__/add/js/jquery-1.7.2.min.js"></script>
    <script src="__ADMIN__/add/js/bootstrap.min.js"></script>
    <script src="__ADMIN__/add/js/layoutManager.js"></script>
    <!--layer-->
    <script src="__Common__/layer/layer.js"></script>
    <!--layer END-->
    <!--layerdate-->
    <script src="__Common__/laydate/laydate.js"></script>
    <!--layerdate END-->

    <!--编辑器-->
    <script src="__Backstage__/lib/ueditor/ueditor.config.js"></script>
    <script src="__Backstage__/lib/ueditor/ueditor.all.min.js"> </script>
    <script src="__Backstage__/lib/ueditor/lang/zh-cn/zh-cn.js"></script>
    <script type="text/javascript">
        var editor = UE.getEditor('article-content');
        //    window.onresize=function(){
        //        window.location.reload();
        //    }
        //    var _uploadEditor;
        //    $(function () {
        //        //重新实例化一个编辑器，防止在上面的editor编辑器中显示上传的图片或者文件
        //        _uploadEditor = UE.getEditor('uploadEditor');
        //        _uploadEditor.ready(function () {
        //            //设置编辑器不可用
        //            //_uploadEditor.setDisabled();
        //            //隐藏编辑器，因为不会用到这个编辑器实例，所以要隐藏
        //            _uploadEditor.hide();
        //            //侦听图片上传
        //            _uploadEditor.addListener('beforeInsertImage', function (t, arg) {
        //
        //                //将地址赋值给相应的input,只去第一张图片的路径
        //                $("#pictureUpload").attr("value", arg[0].src);
        //                //图片预览
        //                //$("#imgPreview").attr("src", arg[0].src);
        //            })
        //            //侦听文件上传，取上传文件列表中第一个上传的文件的路径
        //            _uploadEditor.addListener('afterUpfile', function (t, arg) {
        //                $("#fileUpload").attr("value", _uploadEditor.options.filePath + arg[0].url);
        //            })
        //        });
        //    });
        //    //弹出图片上传的对话框
        //    $('#upImage').click(function () {
        //        var myImage = _uploadEditor.getDialog("insertimage");
        //        myImage.open();
        //    });
        //    //弹出文件上传的对话框
        //    function upFiles() {
        //        var myFiles = _uploadEditor.getDialog("attachment");
        //        myFiles.open();
        //    }
    </script>
    <script src="__ADMIN__/js/bootstrap-multiselect.js"></script>
    <!--编辑器END-->
    <script type="text/javascript">
        $(document).ready(function() {
            $('#example-getting-started').multiselect({
                maxHeight: 200
            });
//        $('.multiselect').multiselect({
//            maxHeight: 400
//        });
        });
    </script>
    <style>
        /* added by xhliu end */
        /**新建更新实体底部浮动保存栏*/
        .bottomBar{
            position:fixed;
            bottom:0px;
            padding:8px 15px 8px 15px;
            width:100%;
            background:rgb(255, 255, 255);
            border-top:1px solid rgb(229,229,229);
        }
        /*select{height: 30px;font-size: 14px;!important;}*/
        /*ul{border-radius: 4px;height: 30px;}*/
    </style>
</head>
<!--引入 head END-->
<body style="overflow-y: auto;padding-top: 0%;outline: none">
<div class="scrollbar mCustomScrollbar _mCS_1 mCS_no_scrollbar" style="height: 100%; width: 100%; position: relative; overflow: visible;background-color: #fff" >
    <div id="mCSB_1" class="mCustomScrollBox mCS-3d mCSB_vertical mCSB_outside" style="max-height: none;border: none;outline: none" tabindex="0">
        <div id="mCSB_1_container" class="mCSB_container mCS_no_scrollbar_y" style="position:relative; top:0; left:0;" dir="ltr">
    <input type="hidden" value="Account" id="entityName">
    <input type="hidden" value="canCreate" id="action">
    <input type="hidden" id="owningUserChange" value="true">
    <form class="form-group" style="border: none" id="form">
        <div id="intro-create-customer" class="container">
            <input type="hidden" id="havaSetLayoutPrivileges" style="border-radius: 3px;">
            <input hidden="hidden" id="type" value="1" style="border-radius: 3px;">
            <div class="form-horizontal" style="clear:both;">
                <a onclick="LM.toggleAreaTitle($(this),&#39;1416981460149&#39;)">
                    <i class="fa fa-lg fa-caret-down"></i>
                    文章信息</a>
                <div name="under_line" class="under_line"></div>
                <br>
                <div id="1416981460149" style="display:block">
                    <div class="form-group">
                        <label class="control-label col-xs-2">
                            <font color="#EE7942">※</font>
                            文章标题
                        </label>
                        <div class="col-xs-10">
                            <input type="text" class="form-control" placeholder="请输入文章标题" name="title" label="文章标题" id="文章标题">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2">
                            <font color="#EE7942">※</font>
                            文章内容
                        </label>
                        <div class="col-xs-10">
                            <script id="article-content" name="content" type="text/plain"></script>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2">
                            <font color="#EE7942">※</font>
                            标签选择
                        </label>
                        <div class="col-xs-10">
                            <!--<select  class="form-control" style="height: 30px;font-size: 12px" name="type" >-->
                                <!--<option value="1" style="text-indent: 10px">文章</option>-->
                                <!--<option value="1" style="text-indent: 10px">导航</option>-->
                            <!--</select>-->
                            <select id="example-getting-started" multiple="multiple" name="tagid[]">
                                <volist name="tag" id="vo">
                                    <option value="{$vo.id}">{$vo.name}</option>
                                </volist>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2">
                            <font color="#EE7942">※</font>
                            封面选择
                        </label>
                        <div class="col-xs-10">
                            <!--<input type="file" class="upload" id="upload"  value="测试" >-->
                            <label style="font-weight: bold; border: 1px dashed #d3d3d3;padding: 10px;color: #d3d3d3;" onclick="upload(1)" id="title1"><i class="fa fa-plus"></i>点击上传</label><p style="color: #c8c8c8;">[上传资料文件不能超过2M]</p>
                            <input type="file" id="idcarda1" style="display: none;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2">
                            <font color="#EE7942">※</font>
                            封面预览
                        </label>
                        <div class="col-xs-10">
                            <a id="ashow" target="_blank"><img width="188px" height="124px" src="" style="display:none" id="showPic" alt=""/></a>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2">
                            <font color="#EE7942">※</font>
                            类型选择
                        </label>
                        <div class="col-xs-10">
                            <select  class="form-control" style="height: 30px;font-size: 12px" name="typeid" >
                                <volist name="type" id="vo">
                                    <option value="{$vo.id}" style="text-indent: 10px">{$vo.name}</option>
                                </volist>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-xs-2">
                            <font color="#EE7942">※</font>
                            栏目选择
                        </label>
                        <div class="col-xs-10">
                            <select  class="form-control" style="height: 30px;font-size: 12px" name="columuid" >
                                <volist name="columu" id="vo">
                                    <option value="{$vo.id}" style="text-indent: 10px">{$vo.name}</option>
                                </volist>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--隐藏域-->

            <input type="hidden" id="small_path"  name="picture"/>
        <!--隐藏域END-->
    </form>

        </div></div><div id="mCSB_1_scrollbar_vertical" class="mCSB_scrollTools mCSB_1_scrollbar mCS-3d mCSB_scrollTools_vertical"><div class="mCSB_draggerContainer"><div id="mCSB_1_dragger_vertical" class="mCSB_dragger" style="position: absolute; min-height: 70px; display: none; height: 731px; max-height: 721px; top: 0px;" oncontextmenu="return false;"><div class="mCSB_dragger_bar" style="line-height: 70px;"></div></div><div class="mCSB_draggerRail"></div></div></div></div>
<div style="display:none;" id="container"> </div>
<br><br><br>

<div class="bottomBar" id="intro-save-customer">
    <div class="row">
        <!-- <div class="col-xs-12" id="intro-save-customer">	 -->
        <div class="col-xs-12">
            <div class="pull-right">
                <!--<button class="btn-link" type="button" onclick="check(this)" id="btn_saveAndOpen"><i class="fa fa-fw fa-save"></i>保存并打开</button>-->
                <!--&nbsp;-->
                <button class="btn btn-warning" type="button" id="btn_save"><i class="fa fa-fw fa-save"></i>保存</button>
                &nbsp;
                <button class="btn btn-default" id="returnBtn" type="button"><i class="fa fa-fw fa-mail-reply"></i>取消</button>
            </div>
        </div>
    </div>
</div>
<!--
<input type="button" class="btn btn-success" value="保存" onclick="check()" id="btn_save" />
-->
<script type="text/javascript">
    $("#check_contacts").on('click', function(){
        //获取搜索路径
        var dpmturl =$(this ).parent().attr('url');
        var source =$(this ).parent().attr('source');
            layer.open({
                type: 2,
                title: '搜索页',
                shadeClose: true,
                shade: 0.8,
                area: ['380px', '90%'],
                content: [dpmturl] //iframe的url
            });
    });

    $('#btn_save').on('click', function(){

        //点击后封禁提交按钮
        $('#btn_save').attr('disabled',"true");

        var data =  $('#form').serialize();
        $.ajax({
            cache: false,
            type: "POST",
            url: "{:U('article/add')}",
            data: data,
            async: false,
            success: function(msg){
                if (msg.error) {
                    layer.msg(msg.info);
                    $('#btn_save').removeAttr('disabled');
                } else if (msg.success) {
                    layer.msg(msg.info);
                    setTimeout(function(){
                        window.parent.location.reload();
                    },2000);
                }
            },
            error: function(msg){
            layer.msg('系统异常,请稍后再试!');
            $('#btn_save').removeAttr('disabled');
            }
        });
    });

    $(document).ready(function(){

        $('.close, #returnBtn').click(function(event){
            parent.layer.closeAll();
//            if (!!window.parent && !!window.parent.popDialog) {
//                window.parent.popDialog.modal('hide');
//            }
        });

        if (parent.window.addTab) {
            // 在呼叫中心界面打开新建客户
            $(".event-iframe:visible", parent.document).attr("src", "/event/createEvent?typeCode=1");
            $("#btn_saveAndOpen, #returnBtn").remove();
        }

    });

</script>

<div class="token-input-dropdown-facebook" style="display: none;"></div><div class="token-input-dropdown-facebook" style="display: none;"></div><div class="token-input-dropdown-facebook" style="display: none;"></div>
</body>
<!--上传封面-->
<script>
    $('#idcarda1').on('click',function(){
        var id= 1;//类型为1
        //选择文件
        $('#idcarda1').change(function(event) {
            var file;
            file=event.target.files[0];
            html5up(file);
            $("#idcarda1").unbind("change");//清除改变事件
        });
    });
    //点击图片上传
    function upload(id){
        var name='#idcarda'+id;
        return $(name).click();
    }
    //上传操作
    function html5up(file){
        var form_data=new FormData();
        form_data.append("Filedata",file);
        $('#idcardac').text('上传中');
        $.ajax({
                    url: '{:U("article/ajaxpicture")}',
                    type: 'POST',
                    processData: false,
                    contentType: false,
                    async:false,
                    data: form_data,
                })
                .success(function(data) {
                    console.log(data);
                    var strs=data.split(",");
                    if(data.status ==0){
                        alert(data.info);
                    }else{
                        //上传完后对输入框
                        $("#showPic").attr({'src':'/Public/Knowledge/'+data});
                        $("#ashow").attr({'href':'/Public/Knowledge/'+data});
                        $("#showPic" ).css({'display':'block'});
                        //给id=small_path的表单项赋值
                        $('#small_path' ).val(data);
                        var result=$('#small_path' ).val();
                        alert('上传完毕');
                    }
                })
    }
    //添加图片到img_box
</script>
<!--上传封面END-->
</html>